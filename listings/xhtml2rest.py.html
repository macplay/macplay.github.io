<!DOCTYPE html>
<html lang="zh_cn">
<head>
<meta charset="utf-8">
<meta name="description" content="xhtml2rest.py">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Nikola (getnikola.com)">
<title>xhtml2rest.py - MacPlay</title>
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
<link href="../assets/css/semantic.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/jquery.fancybox.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="canonical" href="https://macplay.github.io/listings/xhtml2rest.py.html">
</head>
<body>
        <div class="ui grid">
            <div class="computer only three wide column no-print">
                <div id="left-side">
                </div>
            </div>
            <div class="ten wide computer sixteen wide tablet sixteen wide mobile column">
                        <div class="ui inline cookie nag no-print">
            <span class="title">从现在开始，支持中英双语及博文精选 O(∩_∩)O~~</span>
            <i class="close icon"></i>
        </div>
    <header id="header" class="no-print"><div class="ui grid">
        <div class="computer only tablet only sixteen wide column">
            <div class="ui large secondary stackable menu">
                <a class="header item brand-logo" href="https://macplay.github.io/">
                    MacPlay
                </a>
                        <a class="item" href="../">Posts</a>
                        <a class="item" href=".">Code</a>
                        <a class="item" href="../galleries/">Gallery</a>
                        <a class="item" href="../categories/">Tags</a>
                        <a class="item" href="../archive.html">Archive</a>
                <div class="right menu">
                    <a class="item" href="../rss.xml"><i class="rss icon"></i>RSS</a>
                </div>
            </div>
        </div>
        <div class="mobile only sixteen wide column">
            <div class="ui fluid accordion vertical menu">
                <div class="item">
                    <a class="title">MacPlay</a>
                    <div class="content">
                                <a class="item" href="../">Posts</a>
                                <a class="item" href=".">Code</a>
                                <a class="item" href="../galleries/">Gallery</a>
                                <a class="item" href="../categories/">Tags</a>
                                <a class="item" href="../archive.html">Archive</a>
                        <a class="item" href="../rss.xml"><i class="rss icon"></i>RSS</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    </header><main id="main"><div id="main-content">
<div class="listingpage page-body" itemscope="itemscope" itemtype="http://schema.org/Article">
    <div class="ui breadcrumb list-title">
                <a href="." class="section">listings</a>
                <div class="divider"> / </div>
                <div class="section">
                    xhtml2rest.py
                </div>
    </div>

        <p class="downloadlink">
            <i class="download icon"></i><a href="xhtml2rest.py">Download</a>
        </p>
        <div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-1"><code data-line-number="  1"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-1"></a><span class="ch">#!/usr/bin/python</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-2"><code data-line-number="  2"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-2"></a><span class="sd">"""</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-3"><code data-line-number="  3"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-3"></a><span class="sd">NAME</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-4"><code data-line-number="  4"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-4"></a><span class="sd">====</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-5"><code data-line-number="  5"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-5"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-6"><code data-line-number="  6"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-6"></a><span class="sd">xhtml2rest - Convert xhtml to reStructuredText</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-7"><code data-line-number="  7"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-7"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-8"><code data-line-number="  8"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-8"></a><span class="sd">SYNOPSIS</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-9"><code data-line-number="  9"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-9"></a><span class="sd">========</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-10"><code data-line-number=" 10"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-10"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-11"><code data-line-number=" 11"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-11"></a><span class="sd">xhtml2rest *xhtmlfile* &gt; *restfile*</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-12"><code data-line-number=" 12"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-12"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-13"><code data-line-number=" 13"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-13"></a><span class="sd">DESCRIPTION</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-14"><code data-line-number=" 14"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-14"></a><span class="sd">===========</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-15"><code data-line-number=" 15"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-15"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-16"><code data-line-number=" 16"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-16"></a><span class="sd">``xhtml2rest``, which, far from being a decent and complete program, is</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-17"><code data-line-number=" 17"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-17"></a><span class="sd">only something to begin with, hopefully processes the given UTF-8</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-18"><code data-line-number=" 18"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-18"></a><span class="sd">xhtml file and produces reStructuredText "source code" in the standard</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-19"><code data-line-number=" 19"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-19"></a><span class="sd">output.  If your input is html and/or not in UTF-8, you can convert it</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-20"><code data-line-number=" 20"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-20"></a><span class="sd">to UTF-8 xhtml using ``iconv`` and ``tidy``:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-21"><code data-line-number=" 21"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-21"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-22"><code data-line-number=" 22"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-22"></a><span class="sd">    iconv -f *source_encoding* -t utf-8 *source_html* &gt; *html_utf8*</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-23"><code data-line-number=" 23"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-23"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-24"><code data-line-number=" 24"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-24"></a><span class="sd">    tidy -utf8 -asxml -o *xhtmlfile* *html_utf8*</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-25"><code data-line-number=" 25"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-25"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-26"><code data-line-number=" 26"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-26"></a><span class="sd">    xhtml2rest *xhtmlfile* &gt; *restfile*</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-27"><code data-line-number=" 27"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-27"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-28"><code data-line-number=" 28"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-28"></a><span class="sd">Interestingly, since reStructuredText is not simple markup, but has</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-29"><code data-line-number=" 29"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-29"></a><span class="sd">very strict rules with the intention that the source is perfectly</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-30"><code data-line-number=" 30"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-30"></a><span class="sd">readable, it turns out that converting html to reStructuredText is</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-31"><code data-line-number=" 31"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-31"></a><span class="sd">actually *rendering*. ``xhtml2rest`` is a small rendering engine. Since</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-32"><code data-line-number=" 32"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-32"></a><span class="sd">I had no time to study how existing rendering engines work, I had to</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-33"><code data-line-number=" 33"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-33"></a><span class="sd">reinvent the wheel. So although the code is clean (I actually wrote it</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-34"><code data-line-number=" 34"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-34"></a><span class="sd">twice), I doubt that the core logic is adequate for future extensions.</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-35"><code data-line-number=" 35"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-35"></a><span class="sd">But it's better than nothing. There is some documentation in the code,</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-36"><code data-line-number=" 36"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-36"></a><span class="sd">but feel free to email me if you need more explanations.</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-37"><code data-line-number=" 37"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-37"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-38"><code data-line-number=" 38"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-38"></a><span class="sd">LIMITATIONS</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-39"><code data-line-number=" 39"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-39"></a><span class="sd">===========</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-40"><code data-line-number=" 40"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-40"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-41"><code data-line-number=" 41"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-41"></a><span class="sd">I created ``xhtml2rest`` for a very specific job. It does that job</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-42"><code data-line-number=" 42"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-42"></a><span class="sd">correctly, but for your web page it might not work. It should not be</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-43"><code data-line-number=" 43"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-43"></a><span class="sd">very hard, however, either to improve the code, or to determine what</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-44"><code data-line-number=" 44"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-44"></a><span class="sd">it is in your web page that confuses ``xhtml2rest`` and remove it.</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-45"><code data-line-number=" 45"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-45"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-46"><code data-line-number=" 46"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-46"></a><span class="sd">Other than that, there are the following limitations:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-47"><code data-line-number=" 47"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-47"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-48"><code data-line-number=" 48"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-48"></a><span class="sd">* No indented tables</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-49"><code data-line-number=" 49"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-49"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-50"><code data-line-number=" 50"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-50"></a><span class="sd">* No multi-col or -row spans in tables</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-51"><code data-line-number=" 51"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-51"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-52"><code data-line-number=" 52"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-52"></a><span class="sd">* No support for \&lt;br&gt;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-53"><code data-line-number=" 53"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-53"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-54"><code data-line-number=" 54"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-54"></a><span class="sd">* Not tested in nested tables (check http://www.w3m.org/story.html)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-55"><code data-line-number=" 55"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-55"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-56"><code data-line-number=" 56"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-56"></a><span class="sd">* \&lt;th&gt; support is quick and dirty</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-57"><code data-line-number=" 57"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-57"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-58"><code data-line-number=" 58"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-58"></a><span class="sd">* If the same anchor text is met twice, the anchor is ignored</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-59"><code data-line-number=" 59"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-59"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-60"><code data-line-number=" 60"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-60"></a><span class="sd">* No indented \&lt;pre&gt; elements (but I'm not sure the HTML standard</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-61"><code data-line-number=" 61"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-61"></a><span class="sd">  allows them)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-62"><code data-line-number=" 62"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-62"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-63"><code data-line-number=" 63"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-63"></a><span class="sd">* Images are ignored</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-64"><code data-line-number=" 64"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-64"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-65"><code data-line-number=" 65"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-65"></a><span class="sd">* The word HARDWIRED in the code indicates a hardwired hack which is</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-66"><code data-line-number=" 66"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-66"></a><span class="sd">  specific to the job I wanted ``xhtml2rest`` to do.</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-67"><code data-line-number=" 67"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-67"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-68"><code data-line-number=" 68"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-68"></a><span class="sd">META</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-69"><code data-line-number=" 69"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-69"></a><span class="sd">====</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-70"><code data-line-number=" 70"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-70"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-71"><code data-line-number=" 71"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-71"></a><span class="sd">``xhtml2rest`` was created by Antonios Christofides,</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-72"><code data-line-number=" 72"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-72"></a><span class="sd">anthony@itia.ntua.gr, May-June 2005.</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-73"><code data-line-number=" 73"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-73"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-74"><code data-line-number=" 74"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-74"></a><span class="sd">Revision: $Revision: 3753 $</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-75"><code data-line-number=" 75"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-75"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-76"><code data-line-number=" 76"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-76"></a><span class="sd">The code and this text is hereby placed in the public domain.</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-77"><code data-line-number=" 77"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-77"></a><span class="sd">"""</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-78"><code data-line-number=" 78"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-78"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-79"><code data-line-number=" 79"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-79"></a><span class="kn">import</span> <span class="nn">xml.dom.minidom</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-80"><code data-line-number=" 80"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-80"></a><span class="kn">import</span> <span class="nn">re</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-81"><code data-line-number=" 81"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-81"></a><span class="kn">import</span> <span class="nn">sys</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-82"><code data-line-number=" 82"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-82"></a><span class="kn">import</span> <span class="nn">textwrap</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-83"><code data-line-number=" 83"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-83"></a><span class="kn">import</span> <span class="nn">math</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-84"><code data-line-number=" 84"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-84"></a><span class="kn">import</span> <span class="nn">UserList</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-85"><code data-line-number=" 85"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-85"></a><span class="kn">import</span> <span class="nn">warnings</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-86"><code data-line-number=" 86"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-86"></a><span class="kn">import</span> <span class="nn">codecs</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-87"><code data-line-number=" 87"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-87"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-88"><code data-line-number=" 88"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-88"></a><span class="c1">###############################################################################</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-89"><code data-line-number=" 89"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-89"></a><span class="c1"># Global variables. I know. I'm terribly sorry. Please get rid of them.</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-90"><code data-line-number=" 90"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-90"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-91"><code data-line-number=" 91"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-91"></a><span class="c1"># 'unindent' is used by list items. A li list item is always indented, but its</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-92"><code data-line-number=" 92"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-92"></a><span class="c1"># first line is "unindented" and contains the number or bullet. However, it was</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-93"><code data-line-number=" 93"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-93"></a><span class="c1"># difficult for the li node to tell its #text contents (which may be deeply</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-94"><code data-line-number=" 94"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-94"></a><span class="c1"># nested) to use that.  So it just places the number or bullet, which must be 4</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-95"><code data-line-number=" 95"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-95"></a><span class="c1"># characters, like " 1. ", in "unindent". The first text to be rendered uses</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-96"><code data-line-number=" 96"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-96"></a><span class="c1"># the unindent and then sets it to empty again.</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-97"><code data-line-number=" 97"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-97"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-98"><code data-line-number=" 98"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-98"></a><span class="n">unindent</span> <span class="o">=</span> <span class="s1">''</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-99"><code data-line-number=" 99"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-99"></a><span class="n">hyperlinks</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># text-target pairs found in "a href" elements</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-100"><code data-line-number="100"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-100"></a><span class="c1">###############################################################################</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-101"><code data-line-number="101"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-101"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-102"><code data-line-number="102"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-102"></a><span class="k">class</span> <span class="nc">Ditem</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-103"><code data-line-number="103"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-103"></a>    <span class="sd">"""A document item; usually a node, but can be a block of text</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-104"><code data-line-number="104"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-104"></a><span class="sd">    resulting from processing adjacent inline items. If it is a node,</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-105"><code data-line-number="105"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-105"></a><span class="sd">    it is usually the BlockDitem subclass; if it is text, it is</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-106"><code data-line-number="106"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-106"></a><span class="sd">    normally a plain Ditem."""</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-107"><code data-line-number="107"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-107"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-108"><code data-line-number="108"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-108"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>    <span class="c1"># Contained text (empty for BlockDitem)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-109"><code data-line-number="109"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-109"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">''</span>      <span class="c1"># tag for block node, empty for inline</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-110"><code data-line-number="110"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-110"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">indentlevel</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># 0 - unindented; 1 - indented; etc.</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-111"><code data-line-number="111"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-111"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-112"><code data-line-number="112"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-112"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">'("""'</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">+</span><span class="s1">'""")'</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-113"><code data-line-number="113"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-113"></a>    <span class="k">def</span> <span class="nf">propagate_indents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-114"><code data-line-number="114"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-114"></a>        <span class="s2">"Propagates indent level recursively to children"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-115"><code data-line-number="115"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-115"></a>        <span class="k">pass</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-116"><code data-line-number="116"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-116"></a>    <span class="k">def</span> <span class="nf">maxwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-117"><code data-line-number="117"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-117"></a>        <span class="s2">"Width it will occupy if allowed to render on infinite width"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-118"><code data-line-number="118"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-118"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remove_white_space</span><span class="p">()</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-119"><code data-line-number="119"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-119"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentlevel</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-120"><code data-line-number="120"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-120"></a>    <span class="k">def</span> <span class="nf">minwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-121"><code data-line-number="121"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-121"></a>        <span class="s2">"Width it will occupy if wrapped as much as possible"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-122"><code data-line-number="122"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-122"></a>        <span class="n">wordlens</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-123"><code data-line-number="123"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-123"></a>        <span class="k">if</span> <span class="n">wordlens</span><span class="p">:</span> <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">wordlens</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentlevel</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-124"><code data-line-number="124"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-124"></a>        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-125"><code data-line-number="125"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-125"></a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-126"><code data-line-number="126"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-126"></a>        <span class="sd">"""Returns contents formatted so as not to exceed specified</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-127"><code data-line-number="127"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-127"></a><span class="sd">        width, if possible"""</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-128"><code data-line-number="128"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-128"></a>        <span class="k">global</span> <span class="n">unindent</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-129"><code data-line-number="129"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-129"></a>        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">==</span><span class="s1">'pre'</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s2">"What are we doing here?"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-130"><code data-line-number="130"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-130"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remove_white_space</span><span class="p">()</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-131"><code data-line-number="131"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-131"></a>        <span class="c1"># Quick hack to fix a problem. Do we begin with '* '?</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-132"><code data-line-number="132"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-132"></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">' '</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">'*-'</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-133"><code data-line-number="133"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-133"></a>            <span class="c1"># It may be mistaken for a bullet list. Strip it.</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-134"><code data-line-number="134"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-134"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-135"><code data-line-number="135"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-135"></a>        <span class="k">if</span> <span class="n">width</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">minwidth</span><span class="p">():</span> <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minwidth</span><span class="p">()</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-136"><code data-line-number="136"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-136"></a>        <span class="c1"># The textwrap module has the nasty habit of breaking at hyphens. So</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-137"><code data-line-number="137"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-137"></a>        <span class="c1"># we'll do a nasty hack: find a character that does not exist in the</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-138"><code data-line-number="138"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-138"></a>        <span class="c1"># text, replace all hyphens with that character, ok, you get the point.</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-139"><code data-line-number="139"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-139"></a>        <span class="n">hyphensurrogate</span> <span class="o">=</span> <span class="s1">''</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-140"><code data-line-number="140"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-140"></a>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="s1">'!@#$%^&amp;*~'</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-141"><code data-line-number="141"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-141"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-142"><code data-line-number="142"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-142"></a>                <span class="n">hyphensurrogate</span> <span class="o">=</span> <span class="n">c</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-143"><code data-line-number="143"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-143"></a>                <span class="k">break</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-144"><code data-line-number="144"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-144"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">hyphensurrogate</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s2">"Houston we have a problem"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-145"><code data-line-number="145"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-145"></a>        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'-'</span><span class="p">,</span> <span class="n">hyphensurrogate</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-146"><code data-line-number="146"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-146"></a>        <span class="n">wrapper</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">TextWrapper</span><span class="p">(</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-147"><code data-line-number="147"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-147"></a>            <span class="n">initial_indent</span><span class="o">=</span><span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentlevel</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">unindent</span><span class="p">))</span><span class="o">*</span><span class="s1">' '</span><span class="o">+</span><span class="n">unindent</span><span class="p">,</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-148"><code data-line-number="148"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-148"></a>            <span class="n">subsequent_indent</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentlevel</span><span class="o">*</span><span class="s1">' '</span><span class="p">,</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-149"><code data-line-number="149"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-149"></a>            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">break_long_words</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-150"><code data-line-number="150"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-150"></a>        <span class="n">unindent</span> <span class="o">=</span> <span class="s1">''</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-151"><code data-line-number="151"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-151"></a>        <span class="n">text</span> <span class="o">=</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-152"><code data-line-number="152"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-152"></a>        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hyphensurrogate</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-153"><code data-line-number="153"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-153"></a>        <span class="k">return</span> <span class="n">text</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-154"><code data-line-number="154"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-154"></a>    <span class="k">def</span> <span class="nf">empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-155"><code data-line-number="155"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-155"></a>        <span class="s2">"Returns true if contains nothing"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-156"><code data-line-number="156"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-156"></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-157"><code data-line-number="157"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-157"></a>    <span class="k">def</span> <span class="nf">remove_white_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-158"><code data-line-number="158"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-158"></a>        <span class="s2">"Removes extra white space"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-159"><code data-line-number="159"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-159"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">'\s+'</span><span class="p">,</span> <span class="s1">' '</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-160"><code data-line-number="160"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-160"></a>    <span class="k">def</span> <span class="nf">canmerge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-161"><code data-line-number="161"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-161"></a>        <span class="s2">"Tells whether it's possible to merge this Ditem with adjacent ones"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-162"><code data-line-number="162"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-162"></a>        <span class="k">return</span> <span class="kc">True</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-163"><code data-line-number="163"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-163"></a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aditem</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-164"><code data-line-number="164"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-164"></a>        <span class="sd">"""If possible, merges aditem, which should be an adjacent Ditem that</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-165"><code data-line-number="165"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-165"></a><span class="sd">        comes after this one."""</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-166"><code data-line-number="166"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-166"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canmerge</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">aditem</span><span class="o">.</span><span class="n">canmerge</span><span class="p">():</span> <span class="k">return</span> <span class="kc">False</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-167"><code data-line-number="167"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-167"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'_'</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">aditem</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> \
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-168"><code data-line-number="168"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-168"></a>            <span class="ow">and</span> <span class="n">aditem</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s2">""" </span><span class="se">\n\t</span><span class="s2">:.,!=/|;"'?&lt;&gt;[]</span><span class="si">{}</span><span class="s2">()"""</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-169"><code data-line-number="169"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-169"></a>            <span class="c1"># Leave space after link if not followed by punctuation</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-170"><code data-line-number="170"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-170"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+</span> <span class="s1">' '</span> <span class="o">+</span> <span class="n">aditem</span><span class="o">.</span><span class="n">text</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-171"><code data-line-number="171"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-171"></a>        <span class="k">else</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-172"><code data-line-number="172"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-172"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+</span> <span class="n">aditem</span><span class="o">.</span><span class="n">text</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-173"><code data-line-number="173"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-173"></a>        <span class="k">return</span> <span class="kc">True</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-174"><code data-line-number="174"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-174"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-175"><code data-line-number="175"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-175"></a><span class="k">class</span> <span class="nc">BlockDitem</span><span class="p">(</span><span class="n">Ditem</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-176"><code data-line-number="176"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-176"></a>    <span class="s2">"A Ditem which contains other Ditems"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-177"><code data-line-number="177"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-177"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-178"><code data-line-number="178"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-178"></a>        <span class="n">Ditem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-179"><code data-line-number="179"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-179"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-180"><code data-line-number="180"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-180"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Contained Ditems</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-181"><code data-line-number="181"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-181"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-182"><code data-line-number="182"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-182"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">'("'</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">+</span><span class="s1">'"); children = '</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-183"><code data-line-number="183"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-183"></a>    <span class="k">def</span> <span class="nf">maxwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-184"><code data-line-number="184"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-184"></a>        <span class="n">childmaxwidths</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">maxwidth</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-185"><code data-line-number="185"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-185"></a>        <span class="k">return</span> <span class="n">childmaxwidths</span> <span class="ow">and</span> <span class="nb">max</span><span class="p">(</span><span class="n">childmaxwidths</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-186"><code data-line-number="186"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-186"></a>    <span class="k">def</span> <span class="nf">minwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-187"><code data-line-number="187"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-187"></a>        <span class="n">childminwidths</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">minwidth</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-188"><code data-line-number="188"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-188"></a>        <span class="k">return</span> <span class="n">childminwidths</span> <span class="ow">and</span> <span class="nb">max</span><span class="p">(</span><span class="n">childminwidths</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-189"><code data-line-number="189"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-189"></a>    <span class="k">def</span> <span class="nf">propagate_indents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-190"><code data-line-number="190"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-190"></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-191"><code data-line-number="191"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-191"></a>            <span class="n">x</span><span class="o">.</span><span class="n">indentlevel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indentlevel</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-192"><code data-line-number="192"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-192"></a>            <span class="n">x</span><span class="o">.</span><span class="n">propagate_indents</span><span class="p">()</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-193"><code data-line-number="193"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-193"></a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-194"><code data-line-number="194"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-194"></a>        <span class="k">if</span> <span class="n">width</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">minwidth</span><span class="p">():</span> <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minwidth</span><span class="p">()</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-195"><code data-line-number="195"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-195"></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-196"><code data-line-number="196"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-196"></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-197"><code data-line-number="197"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-197"></a>        <span class="k">return</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-198"><code data-line-number="198"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-198"></a>    <span class="k">def</span> <span class="nf">empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-199"><code data-line-number="199"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-199"></a>        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-200"><code data-line-number="200"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-200"></a>    <span class="k">def</span> <span class="nf">canmerge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-201"><code data-line-number="201"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-201"></a>        <span class="k">return</span> <span class="kc">False</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-202"><code data-line-number="202"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-202"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-203"><code data-line-number="203"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-203"></a><span class="k">class</span> <span class="nc">PreDitem</span><span class="p">(</span><span class="n">Ditem</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-204"><code data-line-number="204"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-204"></a>    <span class="s2">"A Ditem representing a literal block"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-205"><code data-line-number="205"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-205"></a>    <span class="k">def</span> <span class="nf">maxwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-206"><code data-line-number="206"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-206"></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-207"><code data-line-number="207"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-207"></a>    <span class="k">def</span> <span class="nf">minwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-208"><code data-line-number="208"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-208"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxwidth</span><span class="p">()</span> <span class="c1"># Literal block; width's given</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-209"><code data-line-number="209"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-209"></a>    <span class="k">def</span> <span class="nf">remove_white_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-210"><code data-line-number="210"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-210"></a>        <span class="k">pass</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-211"><code data-line-number="211"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-211"></a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-212"><code data-line-number="212"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-212"></a>        <span class="n">result</span> <span class="o">=</span> <span class="s1">'::</span><span class="se">\n\n</span><span class="s1">'</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-213"><code data-line-number="213"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-213"></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-214"><code data-line-number="214"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-214"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="s1">'    '</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-215"><code data-line-number="215"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-215"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="s1">'..</span><span class="se">\n\n</span><span class="s1">'</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-216"><code data-line-number="216"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-216"></a>        <span class="k">return</span> <span class="n">result</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-217"><code data-line-number="217"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-217"></a>    <span class="k">def</span> <span class="nf">canmerge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-218"><code data-line-number="218"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-218"></a>        <span class="k">return</span> <span class="kc">False</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-219"><code data-line-number="219"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-219"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-220"><code data-line-number="220"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-220"></a><span class="k">class</span> <span class="nc">HeadingDitem</span><span class="p">(</span><span class="n">BlockDitem</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-221"><code data-line-number="221"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-221"></a>    <span class="s2">"A Ditem representing an h1, h2, ..., h9"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-222"><code data-line-number="222"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-222"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-223"><code data-line-number="223"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-223"></a>        <span class="n">BlockDitem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-224"><code data-line-number="224"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-224"></a>    <span class="k">def</span> <span class="nf">minwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-225"><code data-line-number="225"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-225"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxwidth</span><span class="p">()</span>  <span class="c1"># Headings don't wrap</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-226"><code data-line-number="226"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-226"></a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-227"><code data-line-number="227"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-227"></a>        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-228"><code data-line-number="228"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-228"></a>        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">32767</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-229"><code data-line-number="229"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-229"></a>        <span class="n">level</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-230"><code data-line-number="230"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-230"></a>        <span class="n">underliner</span> <span class="o">=</span> <span class="s2">"=-`'.~*+^"</span><span class="p">[</span><span class="n">level</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-231"><code data-line-number="231"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-231"></a>        <span class="k">return</span> <span class="n">text</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">*</span><span class="n">underliner</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-232"><code data-line-number="232"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-232"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-233"><code data-line-number="233"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-233"></a><span class="k">class</span> <span class="nc">BlockQuoteDitem</span><span class="p">(</span><span class="n">BlockDitem</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-234"><code data-line-number="234"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-234"></a>    <span class="s2">"A Ditem representing a blockquote"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-235"><code data-line-number="235"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-235"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-236"><code data-line-number="236"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-236"></a>        <span class="n">BlockDitem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-237"><code data-line-number="237"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-237"></a>    <span class="k">def</span> <span class="nf">propagate_indents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-238"><code data-line-number="238"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-238"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">indentlevel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indentlevel</span> <span class="o">+</span> <span class="mi">1</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-239"><code data-line-number="239"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-239"></a>        <span class="n">BlockDitem</span><span class="o">.</span><span class="n">propagate_indents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-240"><code data-line-number="240"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-240"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-241"><code data-line-number="241"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-241"></a><span class="k">class</span> <span class="nc">ListDitem</span><span class="p">(</span><span class="n">BlockDitem</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-242"><code data-line-number="242"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-242"></a>    <span class="s2">"A Ditem representing an ol, ul, or dl"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-243"><code data-line-number="243"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-243"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-244"><code data-line-number="244"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-244"></a>        <span class="n">BlockDitem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-245"><code data-line-number="245"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-245"></a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-246"><code data-line-number="246"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-246"></a>        <span class="c1"># First pass the list type and order to the children</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-247"><code data-line-number="247"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-247"></a>        <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-248"><code data-line-number="248"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-248"></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-249"><code data-line-number="249"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-249"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ListItemDitem</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-250"><code data-line-number="250"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-250"></a>                <span class="n">x</span><span class="o">.</span><span class="n">listtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-251"><code data-line-number="251"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-251"></a>                <span class="n">x</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-252"><code data-line-number="252"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-252"></a>                <span class="n">order</span> <span class="o">=</span> <span class="n">order</span><span class="o">+</span><span class="mi">1</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-253"><code data-line-number="253"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-253"></a>        <span class="c1"># And then process normally</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-254"><code data-line-number="254"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-254"></a>        <span class="k">return</span> <span class="n">BlockDitem</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-255"><code data-line-number="255"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-255"></a>        
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-256"><code data-line-number="256"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-256"></a><span class="k">class</span> <span class="nc">ListItemDitem</span><span class="p">(</span><span class="n">BlockDitem</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-257"><code data-line-number="257"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-257"></a>    <span class="s2">"A Ditem representing a li, dt, or dd"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-258"><code data-line-number="258"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-258"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-259"><code data-line-number="259"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-259"></a>        <span class="n">BlockDitem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-260"><code data-line-number="260"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-260"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">listtype</span> <span class="o">=</span> <span class="kc">None</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-261"><code data-line-number="261"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-261"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="mi">0</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-262"><code data-line-number="262"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-262"></a>    <span class="k">def</span> <span class="nf">minwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-263"><code data-line-number="263"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-263"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">'dt'</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxwidth</span><span class="p">()</span>  <span class="c1"># Don't wrap dt</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-264"><code data-line-number="264"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-264"></a>        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">BlockDitem</span><span class="o">.</span><span class="n">minwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-265"><code data-line-number="265"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-265"></a>    <span class="k">def</span> <span class="nf">propagate_indents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-266"><code data-line-number="266"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-266"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'li'</span><span class="p">,</span> <span class="s1">'ol'</span><span class="p">,</span> <span class="s1">'dd'</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-267"><code data-line-number="267"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-267"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">indentlevel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indentlevel</span> <span class="o">+</span> <span class="mi">1</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-268"><code data-line-number="268"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-268"></a>        <span class="n">BlockDitem</span><span class="o">.</span><span class="n">propagate_indents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-269"><code data-line-number="269"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-269"></a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-270"><code data-line-number="270"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-270"></a>        <span class="k">global</span> <span class="n">unindent</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-271"><code data-line-number="271"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-271"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">'li'</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">listtype</span> <span class="o">==</span> <span class="s1">'ol'</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-272"><code data-line-number="272"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-272"></a>            <span class="n">unindent</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'</span><span class="si">%d</span><span class="s1">. '</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">))</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-273"><code data-line-number="273"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-273"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">'li'</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">listtype</span> <span class="o">==</span> <span class="s1">'ul'</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-274"><code data-line-number="274"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-274"></a>            <span class="n">unindent</span> <span class="o">=</span> <span class="s1">'*   '</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-275"><code data-line-number="275"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-275"></a>        <span class="k">return</span> <span class="n">BlockDitem</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-276"><code data-line-number="276"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-276"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-277"><code data-line-number="277"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-277"></a><span class="k">class</span> <span class="nc">RenderedColumn</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-278"><code data-line-number="278"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-278"></a>    <span class="s2">"Width information about a column being rendered"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-279"><code data-line-number="279"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-279"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minwidth</span><span class="p">,</span> <span class="n">maxwidth</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-280"><code data-line-number="280"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-280"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">minwidth</span> <span class="o">=</span> <span class="n">minwidth</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-281"><code data-line-number="281"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-281"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">maxwidth</span> <span class="o">=</span> <span class="n">maxwidth</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-282"><code data-line-number="282"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-282"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">curwidth</span> <span class="o">=</span> <span class="n">maxwidth</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-283"><code data-line-number="283"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-283"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fixedwidth</span> <span class="o">=</span> <span class="mi">0</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-284"><code data-line-number="284"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-284"></a>    <span class="k">def</span> <span class="nf">logwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-285"><code data-line-number="285"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-285"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxwidth</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-286"><code data-line-number="286"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-286"></a>        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxwidth</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-287"><code data-line-number="287"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-287"></a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minwidth</span><span class="p">,</span> <span class="n">maxwidth</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-288"><code data-line-number="288"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-288"></a>        <span class="s2">"Replaces minwidth/maxwidth if greater"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-289"><code data-line-number="289"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-289"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">minwidth</span> <span class="o">=</span> <span class="n">minwidth</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">minwidth</span> <span class="ow">and</span> <span class="n">minwidth</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">minwidth</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-290"><code data-line-number="290"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-290"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">maxwidth</span> <span class="o">=</span> <span class="n">maxwidth</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">maxwidth</span> <span class="ow">and</span> <span class="n">maxwidth</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxwidth</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-291"><code data-line-number="291"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-291"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">curwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxwidth</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-292"><code data-line-number="292"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-292"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-293"><code data-line-number="293"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-293"></a><span class="k">class</span> <span class="nc">RenderedColumns</span><span class="p">(</span><span class="n">UserList</span><span class="o">.</span><span class="n">UserList</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-294"><code data-line-number="294"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-294"></a>    <span class="s2">"A list of RenderedColumn"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-295"><code data-line-number="295"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-295"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alist</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-296"><code data-line-number="296"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-296"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">alist</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-297"><code data-line-number="297"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-297"></a>    <span class="k">def</span> <span class="nf">totalWidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-298"><code data-line-number="298"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-298"></a>        <span class="s2">"Returns total table width"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-299"><code data-line-number="299"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-299"></a>        <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="p">[</span><span class="n">z</span><span class="o">.</span><span class="n">curwidth</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">])</span> \
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-300"><code data-line-number="300"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-300"></a>            <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-301"><code data-line-number="301"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-301"></a>    <span class="k">def</span> <span class="nf">sumLogWidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-302"><code data-line-number="302"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-302"></a>        <span class="s2">"Returns sum of logwidth for nonfixed columns"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-303"><code data-line-number="303"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-303"></a>        <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">,</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-304"><code data-line-number="304"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-304"></a>            <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">logwidth</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">fixedwidth</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-305"><code data-line-number="305"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-305"></a>    <span class="k">def</span> <span class="nf">distributeWidthDifference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-306"><code data-line-number="306"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-306"></a>        <span class="s2">"Step 4 of w3m table rendering algorithm"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-307"><code data-line-number="307"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-307"></a>        <span class="c1"># Note: The use of math.ceil below is because I'd rather have a</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-308"><code data-line-number="308"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-308"></a>        <span class="c1"># suboptimal width (a few characters less than requested width) rather</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-309"><code data-line-number="309"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-309"></a>        <span class="c1"># than go find what to do with rounding.</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-310"><code data-line-number="310"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-310"></a>        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalWidth</span><span class="p">()</span> <span class="o">-</span> <span class="n">width</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-311"><code data-line-number="311"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-311"></a>        <span class="k">assert</span><span class="p">(</span><span class="n">w</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-312"><code data-line-number="312"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-312"></a>        <span class="n">repeat_distribution</span> <span class="o">=</span> <span class="mi">1</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-313"><code data-line-number="313"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-313"></a>        <span class="k">while</span> <span class="n">repeat_distribution</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-314"><code data-line-number="314"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-314"></a>            <span class="n">repeat_distribution</span> <span class="o">=</span> <span class="mi">0</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-315"><code data-line-number="315"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-315"></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-316"><code data-line-number="316"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-316"></a>                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">fixedwidth</span><span class="p">:</span> <span class="k">continue</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-317"><code data-line-number="317"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-317"></a>                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">curwidth</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">logwidth</span><span class="p">()</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">sumLogWidth</span><span class="p">())</span> <span class="o">&lt;</span> \
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-318"><code data-line-number="318"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-318"></a>                    <span class="n">x</span><span class="o">.</span><span class="n">minwidth</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-319"><code data-line-number="319"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-319"></a>                        <span class="n">x</span><span class="o">.</span><span class="n">curwidth</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">minwidth</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-320"><code data-line-number="320"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-320"></a>                        <span class="n">x</span><span class="o">.</span><span class="n">fixedwidth</span> <span class="o">=</span> <span class="mi">1</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-321"><code data-line-number="321"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-321"></a>                        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalWidth</span><span class="p">()</span> <span class="o">-</span> <span class="n">width</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-322"><code data-line-number="322"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-322"></a>                        <span class="n">repeat_distribution</span><span class="o">=</span><span class="mi">1</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-323"><code data-line-number="323"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-323"></a>                        <span class="k">break</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-324"><code data-line-number="324"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-324"></a>        <span class="c1"># Now that the we finished finding which columns need to be fixed to</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-325"><code data-line-number="325"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-325"></a>        <span class="c1"># their minimum width, perform the distribution once again, without</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-326"><code data-line-number="326"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-326"></a>        <span class="c1"># checking, and actually change remaining column widths</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-327"><code data-line-number="327"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-327"></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-328"><code data-line-number="328"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-328"></a>            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">fixedwidth</span><span class="p">:</span> <span class="k">continue</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-329"><code data-line-number="329"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-329"></a>            <span class="n">x</span><span class="o">.</span><span class="n">curwidth</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">curwidth</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">logwidth</span><span class="p">()</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">sumLogWidth</span><span class="p">())</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-330"><code data-line-number="330"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-330"></a>    
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-331"><code data-line-number="331"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-331"></a><span class="k">def</span> <span class="nf">tablehrule</span><span class="p">(</span><span class="n">colwidths</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="s1">'-'</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-332"><code data-line-number="332"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-332"></a>    <span class="s2">"Returns a horizontal table separator for given column widths"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-333"><code data-line-number="333"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-333"></a>    <span class="n">result</span> <span class="o">=</span> <span class="s1">'+'</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-334"><code data-line-number="334"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-334"></a>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">colwidths</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-335"><code data-line-number="335"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-335"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="n">rule</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">'+'</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-336"><code data-line-number="336"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-336"></a>    <span class="k">return</span> <span class="n">result</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-337"><code data-line-number="337"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-337"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-338"><code data-line-number="338"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-338"></a><span class="k">class</span> <span class="nc">TableDitem</span><span class="p">(</span><span class="n">BlockDitem</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-339"><code data-line-number="339"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-339"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-340"><code data-line-number="340"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-340"></a>        <span class="n">BlockDitem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-341"><code data-line-number="341"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-341"></a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-342"><code data-line-number="342"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-342"></a>        <span class="c1"># Uses table rendering algorithm of w3m</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-343"><code data-line-number="343"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-343"></a>        <span class="c1"># (http://www.w3m.org/story.html), but ignoring width attribute</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-344"><code data-line-number="344"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-344"></a>        <span class="c1"># Step 1 </span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-345"><code data-line-number="345"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-345"></a>        <span class="n">columns</span> <span class="o">=</span> <span class="n">RenderedColumns</span><span class="p">([</span><span class="n">RenderedColumn</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">minwidth</span><span class="p">(),</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-346"><code data-line-number="346"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-346"></a>            <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">maxwidth</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>    <span class="c1"># A column can't be smaller than 1 character</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-347"><code data-line-number="347"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-347"></a>            <span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-348"><code data-line-number="348"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-348"></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-349"><code data-line-number="349"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-349"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-350"><code data-line-number="350"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-350"></a>                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">children</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">i</span><span class="p">):</span> <span class="k">continue</span> <span class="c1"># Skip empty columns</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-351"><code data-line-number="351"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-351"></a>                <span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">minwidth</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">maxwidth</span><span class="p">())</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-352"><code data-line-number="352"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-352"></a>        <span class="c1"># Step 2 (width attribute) ignored</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-353"><code data-line-number="353"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-353"></a>        <span class="c1"># Step 3 (already done - list was created with maxwidth)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-354"><code data-line-number="354"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-354"></a>        <span class="c1"># Step 4</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-355"><code data-line-number="355"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-355"></a>        <span class="k">if</span> <span class="n">columns</span><span class="o">.</span><span class="n">totalWidth</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">width</span><span class="p">:</span> <span class="n">columns</span><span class="o">.</span><span class="n">distributeWidthDifference</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-356"><code data-line-number="356"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-356"></a>        <span class="c1"># OK, column widths are now calculated</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-357"><code data-line-number="357"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-357"></a>        <span class="n">colwidths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">curwidth</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-358"><code data-line-number="358"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-358"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">tablehrule</span><span class="p">(</span><span class="n">colwidths</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-359"><code data-line-number="359"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-359"></a>        <span class="n">usedheadbodysep</span> <span class="o">=</span> <span class="kc">False</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-360"><code data-line-number="360"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-360"></a>        <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-361"><code data-line-number="361"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-361"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="n">tr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">colwidths</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-362"><code data-line-number="362"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-362"></a>            <span class="n">rule</span> <span class="o">=</span> <span class="s1">'-'</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-363"><code data-line-number="363"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-363"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">usedheadbodysep</span> <span class="ow">and</span> <span class="n">tr</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">'th'</span> \
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-364"><code data-line-number="364"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-364"></a>                                        <span class="ow">and</span> <span class="n">tr</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-365"><code data-line-number="365"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-365"></a>                <span class="n">rule</span> <span class="o">=</span> <span class="s1">'='</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-366"><code data-line-number="366"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-366"></a>                <span class="n">usedheadbodysep</span> <span class="o">=</span> <span class="kc">True</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-367"><code data-line-number="367"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-367"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="n">tablehrule</span><span class="p">(</span><span class="n">colwidths</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-368"><code data-line-number="368"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-368"></a>        <span class="k">return</span> <span class="n">result</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-369"><code data-line-number="369"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-369"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-370"><code data-line-number="370"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-370"></a><span class="k">class</span> <span class="nc">TrDitem</span><span class="p">(</span><span class="n">BlockDitem</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-371"><code data-line-number="371"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-371"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-372"><code data-line-number="372"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-372"></a>        <span class="n">BlockDitem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-373"><code data-line-number="373"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-373"></a>    <span class="k">def</span> <span class="nf">maxwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-374"><code data-line-number="374"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-374"></a>        <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">,</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-375"><code data-line-number="375"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-375"></a>            <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">maxwidth</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-376"><code data-line-number="376"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-376"></a>    <span class="k">def</span> <span class="nf">minwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-377"><code data-line-number="377"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-377"></a>        <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">,</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-378"><code data-line-number="378"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-378"></a>            <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">minwidth</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-379"><code data-line-number="379"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-379"></a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-380"><code data-line-number="380"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-380"></a>        <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>       <span class="c1"># List of lists of lines</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-381"><code data-line-number="381"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-381"></a>        <span class="n">maxlinecount</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># Num of lines in vertically largest column</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-382"><code data-line-number="382"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-382"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">colwidths</span><span class="p">)):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-383"><code data-line-number="383"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-383"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">i</span><span class="p">:</span> <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">''</span> <span class="p">]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-384"><code data-line-number="384"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-384"></a>            <span class="k">else</span><span class="p">:</span> <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">colwidths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-385"><code data-line-number="385"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-385"></a>            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="s1">' '</span> <span class="o">*</span> <span class="p">(</span><span class="n">colwidths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span> <span class="c1"># Pad to col len</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-386"><code data-line-number="386"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-386"></a>            <span class="n">maxlinecount</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlinecount</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-387"><code data-line-number="387"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-387"></a>            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-388"><code data-line-number="388"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-388"></a>        <span class="c1"># Pad vertically</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-389"><code data-line-number="389"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-389"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-390"><code data-line-number="390"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-390"></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxlinecount</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-391"><code data-line-number="391"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-391"></a>                <span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">' '</span> <span class="o">*</span> <span class="n">colwidths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-392"><code data-line-number="392"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-392"></a>        <span class="n">result</span> <span class="o">=</span> <span class="s1">''</span> 
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-393"><code data-line-number="393"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-393"></a>        <span class="c1"># Add vertical separators</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-394"><code data-line-number="394"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-394"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxlinecount</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-395"><code data-line-number="395"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-395"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="s1">'|'</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-396"><code data-line-number="396"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-396"></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-397"><code data-line-number="397"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-397"></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="n">columns</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">'|'</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-398"><code data-line-number="398"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-398"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-399"><code data-line-number="399"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-399"></a>        <span class="k">return</span> <span class="n">result</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-400"><code data-line-number="400"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-400"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-401"><code data-line-number="401"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-401"></a><span class="k">def</span> <span class="nf">handleNodeList</span><span class="p">(</span><span class="n">nodelist</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-402"><code data-line-number="402"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-402"></a>    <span class="s2">"Processes given nodes; merges them if possible; returns ditem list"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-403"><code data-line-number="403"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-403"></a>    <span class="n">ditems</span> <span class="o">=</span> <span class="p">[]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-404"><code data-line-number="404"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-404"></a>    <span class="n">curditem</span> <span class="o">=</span> <span class="n">Ditem</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-405"><code data-line-number="405"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-405"></a>    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-406"><code data-line-number="406"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-406"></a>        <span class="n">aditem</span> <span class="o">=</span> <span class="n">handleNode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-407"><code data-line-number="407"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-407"></a>        <span class="k">if</span> <span class="n">curditem</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">aditem</span><span class="p">):</span> <span class="k">continue</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-408"><code data-line-number="408"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-408"></a>        <span class="n">ditems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curditem</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-409"><code data-line-number="409"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-409"></a>        <span class="n">curditem</span> <span class="o">=</span> <span class="n">aditem</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-410"><code data-line-number="410"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-410"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">curditem</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span> <span class="n">ditems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curditem</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-411"><code data-line-number="411"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-411"></a>    <span class="k">return</span> <span class="n">ditems</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-412"><code data-line-number="412"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-412"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-413"><code data-line-number="413"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-413"></a><span class="k">def</span> <span class="nf">handleNode</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-414"><code data-line-number="414"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-414"></a>    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeType</span> <span class="o">==</span> <span class="n">node</span><span class="o">.</span><span class="n">TEXT_NODE</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-415"><code data-line-number="415"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-415"></a>        <span class="k">return</span> <span class="n">handleText</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-416"><code data-line-number="416"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-416"></a>    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeName</span><span class="o">==</span><span class="s1">'a'</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-417"><code data-line-number="417"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-417"></a>        <span class="k">return</span> <span class="n">handleAnchor</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-418"><code data-line-number="418"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-418"></a>    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">'h\d'</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeName</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-419"><code data-line-number="419"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-419"></a>        <span class="k">return</span> <span class="n">handleHeading</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-420"><code data-line-number="420"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-420"></a>    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeName</span><span class="o">==</span><span class="s1">'div'</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">'class'</span><span class="p">)</span><span class="o">==</span><span class="s1">'cit'</span><span class="p">:</span>  <span class="c1"># HARDWIRED</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-421"><code data-line-number="421"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-421"></a>        <span class="k">return</span> <span class="n">handleBlockQuote</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-422"><code data-line-number="422"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-422"></a>    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeName</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'body'</span><span class="p">,</span> <span class="s1">'div'</span><span class="p">,</span> <span class="s1">'p'</span><span class="p">,</span> <span class="s1">'td'</span><span class="p">,</span> <span class="s1">'th'</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-423"><code data-line-number="423"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-423"></a>        <span class="k">return</span> <span class="n">handleGenericBlock</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-424"><code data-line-number="424"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-424"></a>    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeName</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'em'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-425"><code data-line-number="425"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-425"></a>        <span class="k">return</span> <span class="n">handleEmphasis</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-426"><code data-line-number="426"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-426"></a>    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeName</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'strong'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-427"><code data-line-number="427"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-427"></a>        <span class="k">return</span> <span class="n">handleStrong</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-428"><code data-line-number="428"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-428"></a>    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeName</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'ol'</span><span class="p">,</span> <span class="s1">'ul'</span><span class="p">,</span> <span class="s1">'dl'</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-429"><code data-line-number="429"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-429"></a>        <span class="k">return</span> <span class="n">handleList</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-430"><code data-line-number="430"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-430"></a>    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeName</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'li'</span><span class="p">,</span> <span class="s1">'dd'</span><span class="p">,</span> <span class="s1">'dt'</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-431"><code data-line-number="431"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-431"></a>        <span class="k">return</span> <span class="n">handleListItem</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-432"><code data-line-number="432"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-432"></a>    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeName</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'table'</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-433"><code data-line-number="433"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-433"></a>        <span class="k">return</span> <span class="n">handleTable</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-434"><code data-line-number="434"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-434"></a>    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeName</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'tr'</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-435"><code data-line-number="435"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-435"></a>        <span class="k">return</span> <span class="n">handleTr</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-436"><code data-line-number="436"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-436"></a>    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeName</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'pre'</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-437"><code data-line-number="437"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-437"></a>        <span class="k">return</span> <span class="n">handlePre</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-438"><code data-line-number="438"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-438"></a>    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">hasChildNodes</span><span class="p">():</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-439"><code data-line-number="439"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-439"></a>        <span class="n">contents</span> <span class="o">=</span> <span class="n">handleNodeList</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">childNodes</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-440"><code data-line-number="440"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-440"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-441"><code data-line-number="441"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-441"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">Ditem</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-442"><code data-line-number="442"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-442"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">BlockDitem</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">nodeName</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-443"><code data-line-number="443"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-443"></a>        <span class="n">result</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">contents</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-444"><code data-line-number="444"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-444"></a>        <span class="k">return</span> <span class="n">result</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-445"><code data-line-number="445"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-445"></a>    <span class="k">return</span> <span class="n">Ditem</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-446"><code data-line-number="446"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-446"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-447"><code data-line-number="447"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-447"></a><span class="k">def</span> <span class="nf">processChildren</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-448"><code data-line-number="448"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-448"></a>    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">hasChildNodes</span><span class="p">():</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-449"><code data-line-number="449"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-449"></a>        <span class="k">return</span> <span class="n">handleNodeList</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">childNodes</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-450"><code data-line-number="450"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-450"></a>    <span class="k">else</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-451"><code data-line-number="451"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-451"></a>        <span class="k">return</span> <span class="p">()</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-452"><code data-line-number="452"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-452"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-453"><code data-line-number="453"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-453"></a><span class="k">def</span> <span class="nf">mergeChildren</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-454"><code data-line-number="454"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-454"></a>    <span class="n">contents</span> <span class="o">=</span> <span class="n">processChildren</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-455"><code data-line-number="455"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-455"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">'Unexpected block elements'</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-456"><code data-line-number="456"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-456"></a>    <span class="k">if</span> <span class="n">contents</span><span class="p">:</span> <span class="k">return</span> <span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-457"><code data-line-number="457"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-457"></a>    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">Ditem</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-458"><code data-line-number="458"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-458"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-459"><code data-line-number="459"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-459"></a><span class="k">def</span> <span class="nf">handleText</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-460"><code data-line-number="460"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-460"></a>    <span class="k">return</span> <span class="n">Ditem</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-461"><code data-line-number="461"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-461"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-462"><code data-line-number="462"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-462"></a><span class="k">def</span> <span class="nf">handleAnchor</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-463"><code data-line-number="463"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-463"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">mergeChildren</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-464"><code data-line-number="464"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-464"></a>    <span class="n">result</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeName</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-465"><code data-line-number="465"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-465"></a>    <span class="n">result</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-466"><code data-line-number="466"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-466"></a>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">''</span><span class="p">:</span> <span class="k">return</span> <span class="n">result</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-467"><code data-line-number="467"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-467"></a>    <span class="n">target</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-468"><code data-line-number="468"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-468"></a>    <span class="k">if</span> <span class="n">target</span><span class="o">==</span><span class="s2">""</span> <span class="ow">or</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">'#'</span><span class="p">:</span> <span class="k">return</span> <span class="n">result</span>  <span class="c1"># Ignore intrnl links</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-469"><code data-line-number="469"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-469"></a>    <span class="n">result</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">'\s+'</span><span class="p">,</span> <span class="s1">' '</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-470"><code data-line-number="470"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-470"></a>    <span class="n">key</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-471"><code data-line-number="471"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-471"></a>    <span class="k">if</span> <span class="n">hyperlinks</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">and</span> <span class="n">hyperlinks</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">!=</span><span class="n">target</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-472"><code data-line-number="472"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-472"></a>        <span class="c1"># The following try-except is a quick hack to ensure that the</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-473"><code data-line-number="473"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-473"></a>        <span class="c1"># program will not stop because of problems in the warning</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-474"><code data-line-number="474"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-474"></a>        <span class="c1"># mechanism. One such specific problem is a UnicodeEncodeError </span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-475"><code data-line-number="475"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-475"></a>        <span class="c1"># when result.text contains difficult characters.</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-476"><code data-line-number="476"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-476"></a>        <span class="k">try</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-477"><code data-line-number="477"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-477"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">"Ignoring second appearance of anchor '"</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">text</span> <span class="o">+</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-478"><code data-line-number="478"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-478"></a>                                                    <span class="s2">"' with different target"</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-479"><code data-line-number="479"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-479"></a>        <span class="k">except</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-480"><code data-line-number="480"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-480"></a>            <span class="k">pass</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-481"><code data-line-number="481"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-481"></a>        <span class="k">return</span> <span class="n">result</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-482"><code data-line-number="482"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-482"></a>    <span class="n">hyperlinks</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-483"><code data-line-number="483"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-483"></a>    <span class="n">result</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'`'</span><span class="o">+</span><span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="o">+</span><span class="s1">'`_'</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-484"><code data-line-number="484"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-484"></a>    <span class="k">return</span> <span class="n">result</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-485"><code data-line-number="485"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-485"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-486"><code data-line-number="486"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-486"></a><span class="k">def</span> <span class="nf">handleHeading</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-487"><code data-line-number="487"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-487"></a>    <span class="n">contents</span> <span class="o">=</span> <span class="n">mergeChildren</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-488"><code data-line-number="488"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-488"></a>    <span class="k">if</span> <span class="n">contents</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span> <span class="k">return</span> <span class="n">contents</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-489"><code data-line-number="489"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-489"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">HeadingDitem</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">nodeName</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-490"><code data-line-number="490"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-490"></a>    <span class="n">result</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-491"><code data-line-number="491"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-491"></a>    <span class="k">return</span> <span class="n">result</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-492"><code data-line-number="492"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-492"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-493"><code data-line-number="493"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-493"></a><span class="k">def</span> <span class="nf">handleEmphasis</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-494"><code data-line-number="494"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-494"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">mergeChildren</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-495"><code data-line-number="495"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-495"></a>    <span class="n">result</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeName</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-496"><code data-line-number="496"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-496"></a>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-497"><code data-line-number="497"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-497"></a>        <span class="n">result</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'*'</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">text</span> <span class="o">+</span> <span class="s1">'*'</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-498"><code data-line-number="498"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-498"></a>    <span class="k">return</span> <span class="n">result</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-499"><code data-line-number="499"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-499"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-500"><code data-line-number="500"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-500"></a><span class="k">def</span> <span class="nf">handleStrong</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-501"><code data-line-number="501"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-501"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">mergeChildren</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-502"><code data-line-number="502"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-502"></a>    <span class="n">result</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeName</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-503"><code data-line-number="503"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-503"></a>    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-504"><code data-line-number="504"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-504"></a>        <span class="n">result</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">'**'</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">text</span> <span class="o">+</span> <span class="s1">'**'</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-505"><code data-line-number="505"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-505"></a>    <span class="k">return</span> <span class="n">result</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-506"><code data-line-number="506"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-506"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-507"><code data-line-number="507"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-507"></a><span class="k">def</span> <span class="nf">handleGenericBlock</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-508"><code data-line-number="508"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-508"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">BlockDitem</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">nodeName</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-509"><code data-line-number="509"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-509"></a>    <span class="n">result</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">processChildren</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-510"><code data-line-number="510"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-510"></a>    <span class="k">return</span> <span class="n">result</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-511"><code data-line-number="511"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-511"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-512"><code data-line-number="512"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-512"></a><span class="k">def</span> <span class="nf">handleBlockQuote</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-513"><code data-line-number="513"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-513"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">BlockQuoteDitem</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">nodeName</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-514"><code data-line-number="514"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-514"></a>    <span class="n">result</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">processChildren</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-515"><code data-line-number="515"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-515"></a>    <span class="k">return</span> <span class="n">result</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-516"><code data-line-number="516"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-516"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-517"><code data-line-number="517"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-517"></a><span class="k">def</span> <span class="nf">handleList</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-518"><code data-line-number="518"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-518"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">ListDitem</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">nodeName</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-519"><code data-line-number="519"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-519"></a>    <span class="n">result</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">processChildren</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-520"><code data-line-number="520"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-520"></a>    <span class="k">return</span> <span class="n">result</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-521"><code data-line-number="521"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-521"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-522"><code data-line-number="522"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-522"></a><span class="k">def</span> <span class="nf">handleListItem</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-523"><code data-line-number="523"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-523"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">ListItemDitem</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">nodeName</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-524"><code data-line-number="524"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-524"></a>    <span class="n">result</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">processChildren</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-525"><code data-line-number="525"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-525"></a>    <span class="k">return</span> <span class="n">result</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-526"><code data-line-number="526"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-526"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-527"><code data-line-number="527"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-527"></a><span class="k">def</span> <span class="nf">handleTable</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-528"><code data-line-number="528"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-528"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">TableDitem</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">nodeName</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-529"><code data-line-number="529"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-529"></a>    <span class="c1"># Ignore table contents that are not tr</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-530"><code data-line-number="530"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-530"></a>    <span class="n">result</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-531"><code data-line-number="531"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-531"></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">processChildren</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">type</span><span class="o">==</span><span class="s1">'tr'</span><span class="p">]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-532"><code data-line-number="532"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-532"></a>    <span class="k">return</span> <span class="n">result</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-533"><code data-line-number="533"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-533"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-534"><code data-line-number="534"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-534"></a><span class="k">def</span> <span class="nf">handleTr</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-535"><code data-line-number="535"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-535"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">TrDitem</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">nodeName</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-536"><code data-line-number="536"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-536"></a>    <span class="c1"># Ignore tr contents that are not th or td</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-537"><code data-line-number="537"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-537"></a>    <span class="n">result</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-538"><code data-line-number="538"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-538"></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">processChildren</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'th'</span><span class="p">,</span> <span class="s1">'td'</span><span class="p">)]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-539"><code data-line-number="539"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-539"></a>    <span class="k">return</span> <span class="n">result</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-540"><code data-line-number="540"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-540"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-541"><code data-line-number="541"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-541"></a><span class="k">def</span> <span class="nf">handlePre</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-542"><code data-line-number="542"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-542"></a>    <span class="k">return</span> <span class="n">PreDitem</span><span class="p">(</span><span class="n">mergeChildren</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-543"><code data-line-number="543"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-543"></a>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-544"><code data-line-number="544"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-544"></a><span class="n">dom1</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-545"><code data-line-number="545"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-545"></a><span class="n">ditem</span> <span class="o">=</span> <span class="n">handleNode</span><span class="p">(</span><span class="n">dom1</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s2">"body"</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-546"><code data-line-number="546"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-546"></a><span class="n">ditem</span><span class="o">.</span><span class="n">propagate_indents</span><span class="p">()</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-547"><code data-line-number="547"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-547"></a><span class="p">(</span><span class="n">utf8_encode</span><span class="p">,</span> <span class="n">utf8_decode</span><span class="p">,</span> <span class="n">utf8_reader</span><span class="p">,</span> <span class="n">utf8_writer</span><span class="p">)</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-548"><code data-line-number="548"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-548"></a><span class="n">outf</span> <span class="o">=</span> <span class="n">utf8_writer</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-549"><code data-line-number="549"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-549"></a><span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ditem</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">79</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-550"><code data-line-number="550"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-550"></a><span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hyperlinks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#listingsxhtml2restpy-551"><code data-line-number="551"></code></a></td>
<td class="code"><code><a name="listingsxhtml2restpy-551"></a>    <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">.. _`'</span> <span class="o">+</span> <span class="n">h</span> <span class="o">+</span> <span class="s1">'`:</span><span class="se">\n</span><span class="s1">    '</span> <span class="o">+</span> <span class="n">hyperlinks</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
</code></td>
</tr>
</table></div>
</div>
                    </div>
                </main><div class="footer extra-block no-print">
    <span class="footer_item">
        <a href="../pages/you-qing-lian-jie/">友情链接</a>
    </span>
    <span class="footer_item">
        <a href="../pages/liu-yan-ban/">留言板</a>
    </span>
    <span class="footer_item">
        <a href="../pages/ge-ren-dong-tai/">碎碎念</a>
    </span>
    </div>
            <div class="footer social-link no-print">
            <a href="https://github.com/ashfinal" target="_blank"><i class="grey large github icon"></i></a>
            <a href="http://weibo.com/ashfinal/" target="_blank"><i class="grey large weibo icon"></i></a>
            <a href="mailto://ashfinal@sina.cn" target="_blank"><i class="grey large mail icon"></i></a>
            </div>
        <div class="ui basic center aligned segment no-print">Contents © 2020         <a href="mailto:ashfinal@sina.cn">ashfinal</a> - Powered by         <a href="https://getnikola.com" target="_blank" rel="nofollow">Nikola</a>         </div>

            </div>
            <div class="computer only three wide column no-print">
                <div id="right-side">
                </div>
            </div>
        </div>

        <!-- GoStats JavaScript Based Code -->
        <script type="text/javascript">(function(c,o,m,p,u,t,e){
        c['GoStatsObject']=u;c[u]=c[u]||function(){(c[u].q=c[u].q||[]).push(arguments)},
        c[u].l=1*new Date();t=o.createElement(m);t.async=1;t.src=p;
        e=o.getElementsByTagName(m)[0];e.parentNode.insertBefore(t,e);
        })(window,document,'script','//www.gostats.org/5.js','go');
        go('init',100479892,{'img_counter_type':5,'img_image_type':1});go('send');</script><!-- End GoStats JavaScript Based Code --><script type="text/javascript" src="../assets/js/jquery-3.3.1.min.js"></script><script type="text/javascript" src="../assets/js/semantic.min.js"></script><script type="text/javascript" src="../assets/js/jquery.fancybox.min.js"></script><script type="text/javascript" src="../assets/js/cookie.min.js"></script><script>
            $(document).ready(function(){
                $(".ui.dropdown").dropdown();
                $('.ui.accordion').accordion();
                var newstr = $('.cookie.nag').text();
                $('.cookie.nag').nag({
                    key: 'globalnotice',
                    value: newstr
                  });
                $('.image-reference').fancybox();
            });
        </script>
</body>
</html>
